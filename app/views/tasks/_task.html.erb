<%= turbo_frame_tag "task_#{task.id}", data: { task_id: task.id } do %>
  <div
    data-controller="inline-edit"
    data-search-target="task"
    data-search-content-value="<%= task.content.downcase %>"
    class="p-4 bg-white rounded shadow"
  >
    <div class="flex items-center justify-between mb-2">
      <!-- Display Mode for CONTENT (Stimulus) -->
      <div
        data-inline-edit-target="display"
        class="flex items-center gap-3 flex-1"
      >
        <%= form_with(model: task, method: :patch) do |form| %>
          <%= form.check_box :status,
                             { onchange: "this.form.requestSubmit()",
                               class: "w-5 h-5" },
                             "done",
                             "todo"
          %>
        <% end %>

        <span
          data-action="click->inline-edit#edit"
          class="<%= 'line-through text-gray-400' if task.done? %> cursor-pointer"
        >
          <%= task.content %>
        </span>
      </div>

      <!-- Edit Mode for CONTENT (Stimulus) -->
      <div data-inline-edit-target="form" class="hidden flex-1 gap-2">
        <%= form_with(model: task, method: :patch, class: "flex gap-2 flex-1") do |form| %>
          <%= form.text_field :content, 
              data: { 
                inline_edit_target: "input",
                action: "keydown->inline-edit#handleKeydown"
              },
              class: "flex-1 px-4 py-2 border rounded" %>
          <%= form.submit "Save", class: "px-4 py-2 bg-blue-500 text-white rounded" %>
          <button
            type="button"
            data-action="click->inline-edit#cancel"
            class="px-4 py-2 bg-gray-300 rounded"
          >
            Cancel
          </button>
        <% end %>
      </div>

      <%= button_to "Delete", task_path(task), 
          method: :delete,
          data: { inline_edit_target: "deleteButton" },
          class: "text-red-500 hover:text-red-700" %>
    </div>

    <!-- Description section (Turbo Frame pattern) -->
    <div class="mt-2 pl-8">
      <%= turbo_frame_tag "task_#{task.id}_description" do %>
        <div class="text-sm text-gray-600">
          <% if task.description.present? %>
            <div class="prose prose-sm max-w-none">
              <%= task.description %>
            </div>
            <%= link_to "Edit description", 
                edit_task_path(task, edit_type: :description),
                class: "text-blue-500 text-xs hover:underline" %>
          <% else %>
            <%= link_to "+ Add description", 
                edit_task_path(task, edit_type: :description),
                class: "text-blue-500 text-xs hover:underline" %>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
